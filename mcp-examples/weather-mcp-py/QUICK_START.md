# ğŸš€ Quick Start - Weather MCP Server (Simplified API)

## âœ… ConfiguraciÃ³n Completada

El proyecto ya estÃ¡ configurado para usar **payments-py local** (equivalente a `npm link`).

---

## ğŸ“‹ Pasos RÃ¡pidos

### 1. Instalar Dependencias Locales

```bash
cd /Users/charly/Sites/nevermined/tutorials/mcp-examples/weather-mcp-py

# OpciÃ³n A: Script automÃ¡tico (recomendado)
chmod +x setup_local.sh
./setup_local.sh

# OpciÃ³n B: Manual con Poetry
poetry install
```

### 2. Configurar Variables de Entorno

```bash
# Si no existe .env, crÃ©alo
cp .env.example .env

# Editar .env con tus credenciales
# - NVM_SERVER_API_KEY=...
# - NVM_AGENT_ID=...
# - NVM_ENV=staging_sandbox
# - PORT=5001
```

### 3. Ejecutar Servidor

```bash
# OpciÃ³n A: Con script helper
./run_simplified.sh

# OpciÃ³n B: Con Poetry directamente
poetry run python src/server.py

# OpciÃ³n C: Activar env y ejecutar
poetry shell
python src/server.py
```

---

## ğŸ¯ Lo Que Cambiamos

### `pyproject.toml`

**Antes (PyPI):**

```toml
payments-py = "0.7.6"  # â† VersiÃ³n antigua de PyPI (sin Simplified API)
```

**Ahora (Local):**

```toml
payments-py = { path = "../../../payments-py", develop = true }  # â† Tu cÃ³digo local con Simplified API
```

### `src/server.py`

```python
from payments_py import Payments

# Simplified API (nueva)
payments.mcp.registerTool("weather.today", config, handler, options)
payments.mcp.registerResource("weather://today/{city}", config, handler, options)
payments.mcp.registerPrompt("weather.ensureCity", config, handler, options)

# Iniciar servidor completo con OAuth automÃ¡tico
result = await payments.mcp.start({
    "port": 5001,
    "agentId": NVM_AGENT_ID,
    "serverName": "weather-mcp",
    "version": "0.1.0"
})
```

---

## âœ¨ Ventajas de Usar Local

- âœ… **Cambios en tiempo real**: Editas `payments-py`, se refleja inmediatamente en `weather-mcp-py`
- âœ… **No reinstalar**: No necesitas `poetry update` despuÃ©s de cada cambio
- âœ… **Debugging fÃ¡cil**: Puedes debuggear directamente en `payments-py`
- âœ… **Desarrollo paralelo**: Desarrolla ambos proyectos simultÃ¡neamente

---

## ğŸ§ª Verificar que Funciona

### 1. Verificar VersiÃ³n Local

```bash
poetry show payments-py
```

**Debe mostrar:**

```
name         : payments-py
location     : /Users/charly/Sites/nevermined/payments-py  â† Â¡Path local!
```

### 2. Verificar Simplified API

```bash
poetry run python -c "
from payments_py import Payments
p = Payments(nvm_api_key='test', environment='staging_sandbox')
print('âœ… registerTool:', hasattr(p.mcp, 'registerTool'))
print('âœ… start:', hasattr(p.mcp, 'start'))
print('âœ… stop:', hasattr(p.mcp, 'stop'))
"
```

**Debe mostrar:**

```
âœ… registerTool: True
âœ… start: True
âœ… stop: True
```

### 3. Ejecutar Servidor

```bash
poetry run python src/server.py
```

**Debe mostrar:**

```
ğŸš€ Weather MCP Server with Nevermined Integration Started!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¡ MCP Endpoint:     http://localhost:5001/mcp
ğŸ¥ Health Check:     http://localhost:5001/health
â„¹ï¸  Server Info:      http://localhost:5001/

ğŸ” OAuth Endpoints (auto-generated by Nevermined):
   â”œâ”€ Discovery:     http://localhost:5001/.well-known/oauth-authorization-server
   â”œâ”€ Protected:     http://localhost:5001/.well-known/oauth-protected-resource
   â”œâ”€ OIDC Config:   http://localhost:5001/.well-known/openid-configuration
   â””â”€ Registration:  http://localhost:5001/register

ğŸ› ï¸  Tools: weather.today (dynamic credits)
ğŸ“¦ Resources: weather://today/{city} (5 credits)
ğŸ’¬ Prompts: weather.ensureCity (1 credit)
```

---

## ğŸ› Troubleshooting

### Error: "No module named 'payments_py.mcp.core.server_manager'"

**Causa:** payments-py local no estÃ¡ instalado correctamente.

**SoluciÃ³n:**

```bash
# Limpiar y reinstalar
poetry env remove --all
poetry install
```

### Error: "AttributeError: 'MCPIntegration' object has no attribute 'registerTool'"

**Causa:** EstÃ¡s usando la versiÃ³n antigua de PyPI en lugar de la local.

**SoluciÃ³n:**

```bash
# Verificar quÃ© versiÃ³n usa
poetry show payments-py

# Si no muestra location local:
poetry remove payments-py
poetry add --editable ../../../payments-py
poetry install
```

### Servidor no inicia

**Causa:** Falta configuraciÃ³n en `.env`.

**SoluciÃ³n:**

```bash
# Crear .env
cp .env.example .env

# Editar con tus credenciales
nano .env
```

---

## ğŸ“š DocumentaciÃ³n Adicional

- `README_SIMPLIFIED_API.md` - GuÃ­a completa de Simplified API
- `SETUP_LOCAL_PAYMENTS.md` - Detalles de configuraciÃ³n local
- `IMPLEMENTATION_SUMMARY.md` - Resumen tÃ©cnico de la implementaciÃ³n

---

## ğŸ‰ Â¡Listo!

Ahora tienes:

âœ… `weather-mcp-py` usando `payments-py` local  
âœ… Simplified API disponible  
âœ… OAuth 2.1 automÃ¡tico  
âœ… Session management automÃ¡tico  
âœ… Desarrollo en tiempo real  

**Ejecuta:**

```bash
./run_simplified.sh
```

**Y disfruta de un servidor MCP completo en 15 lÃ­neas de cÃ³digo.** ğŸš€



